<!DOCTYPE html>
<html lang="zh-Hant">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>簡易計算機</title>
        <!-- Bootstrap 5 -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
        <style>
            .calculator {
                max-width: 250px;
                margin: 50px auto;
            }
            .calculator button {
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
            }
            #display {
                height: 60px;
                font-size: 1.5rem;
                text-align: right;
                padding-right: 10px;
            }
        </style>
    </head>
    <body class="bg-light">
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#calculatorModal">開啟計算機</button>
        <input type="text" class="form-control basicVehicle2" placeholder="台數" />
        <!-- 彈跳視窗 -->
        <div class="modal fade" id="calculatorModal" tabindex="-1" aria-labelledby="calculatorModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content border-0 shadow-lg">
                    <div class="modal-body">
                        <!-- ✅ 你的計算機 -->
                        <div class="calculator card border-0">
                            <input type="text" id="display" class="form-control mb-3 text-end" disabled placeholder="0" />

                            <div class="d-flex flex-wrap justify-content-between">
                                <!-- 第一列 -->
                                <button class="btn btn-secondary m-1 flex-fill" onclick="press('7')">7</button>
                                <button class="btn btn-secondary m-1 flex-fill" onclick="press('8')">8</button>
                                <button class="btn btn-secondary m-1 flex-fill" onclick="press('9')">9</button>

                                <!-- 第二列 -->
                                <button class="btn btn-secondary m-1 flex-fill" onclick="press('4')">4</button>
                                <button class="btn btn-secondary m-1 flex-fill" onclick="press('5')">5</button>
                                <button class="btn btn-secondary m-1 flex-fill" onclick="press('6')">6</button>

                                <!-- 第三列 -->
                                <button class="btn btn-secondary m-1 flex-fill" onclick="press('1')">1</button>
                                <button class="btn btn-secondary m-1 flex-fill" onclick="press('2')">2</button>
                                <button class="btn btn-secondary m-1 flex-fill" onclick="press('3')">3</button>

                                <!-- 第四列 -->
                                <button class="btn btn-secondary m-1 flex-fill" onclick="press('0')">0</button>
                                <button class="btn btn-warning m-1 flex-fill" onclick="backspace()">⌫</button>
                                <button class="btn btn-success m-1 flex-fill" onclick="sendToTarget()">⏎</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- <div class="calculator card shadow-sm p-3">
            <input type="text" id="display" class="form-control mb-3" disabled placeholder="0" />

            <div class="d-flex flex-wrap justify-content-between">
                <button class="btn btn-secondary m-1" onclick="press('7')">7</button>
                <button class="btn btn-secondary m-1" onclick="press('8')">8</button>
                <button class="btn btn-secondary m-1" onclick="press('9')">9</button>

                <button class="btn btn-secondary m-1" onclick="press('4')">4</button>
                <button class="btn btn-secondary m-1" onclick="press('5')">5</button>
                <button class="btn btn-secondary m-1" onclick="press('6')">6</button>

                <button class="btn btn-secondary m-1" onclick="press('1')">1</button>
                <button class="btn btn-secondary m-1" onclick="press('2')">2</button>
                <button class="btn btn-secondary m-1" onclick="press('3')">3</button>

                <button class="btn btn-secondary m-1" onclick="press('0')">0</button>
                <button class="btn btn-warning m-1" onclick="backspace()">⌫</button>
                <button class="btn btn-success m-1" onclick="sendToTarget()">⏎</button>
            </div>
        </div> -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
        <!-- <script>
            let expression = '';

            function press(value) {
                expression += value;
                document.getElementById('display').value = expression;
            }

            function calculate() {
                try {
                    // 使用 eval 計算（簡易版）
                    expression = eval(expression).toString();
                    document.getElementById('display').value = expression;
                } catch {
                    document.getElementById('display').value = '錯誤';
                    expression = '';
                }
            }

            function clearDisplay() {
                expression = '';
                document.getElementById('display').value = '';
            }

            function backspace() {
                // 移除 expression 最後一個字元
                expression = expression.slice(0, -1);
                document.getElementById('display').value = expression;
            }

            function sendToTarget() {
                const result = document.getElementById('display').value;
                document.getElementById('target').value = result;
            }
        </script> -->
        <script>
            let currentTarget = null;
            let expression = '';

            // 綁定所有 input 觸發 modal
            document.querySelectorAll('.form-control').forEach(input => {
                input.addEventListener('click', function () {
                    currentTarget = this; // 記錄點擊的目標
                    expression = this.value || '';
                    document.getElementById('display').value = expression;
                    const modal = new bootstrap.Modal(document.getElementById('calculatorModal'));
                    modal.show();
                });
            });

            // 數字輸入
            function press(num) {
                expression += num;
                document.getElementById('display').value = expression;
            }

            // 刪除最後一個字
            function backspace() {
                expression = expression.slice(0, -1);
                document.getElementById('display').value = expression;
            }

            // 帶入結果並關閉 modal
            function sendToTarget() {
                if (currentTarget) currentTarget.value = expression;
                const modalEl = document.getElementById('calculatorModal');
                const modal = bootstrap.Modal.getInstance(modalEl);
                modal.hide();
            }
        </script>
    </body>
</html>
